<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/index.css">
</head>
<body>
<header class="headList">
  <div class="headWrap">
    <div class="headLeft">
      <ul>
        <li><a href="#">菜单1</a></li><li class="line">|</li>
        <li><a href="#">菜单1</a></li><li class="line">|</li>
        <li><a href="#">菜单1</a></li><li class="line">|</li>
        <li><a href="#">菜单1</a></li><li class="line">|</li>
        <li><a href="#">菜单1</a></li><li class="line">|</li>
        <li><a href="#">菜单1</a></li><li class="line">|</li>
        <li><a href="#">菜单1</a></li><li class="line">|</li>
        <li><a href="#">菜单1</a></li><li class="line">|</li>
        <li><a href="#">菜单1</a></li><li class="line">|</li>
        <li><a href="#">菜单1菜单1</a></li>
      </ul>
    </div>
    <div class="headRight">
      <ul>
        <li id="login" class="login"><a href="#">登录</a></li>
        <li class="line">|</li>
        <li id="register" class="register"> <a href="#">注册</a></li>
        <li class="line">|</li>
        <li id="buy_car" class="buy_car"><a href="#">购物车</a></li>
      </ul>
    </div>
  </div>
</header>
<nav id="main-nav" class="main-nav clearfix">
  <ul></ul>
</nav>
<div id="hotPro" class="hotPro">

</div>


<script type="text/javascript" src="js/myajax.js"></script>
<script>

  var cat_id = matchQueryString('cat_id');
  var hotPro = document.querySelector('#hotPro');
  var oNavUl = document.querySelector('#main-nav').querySelector('ul');

  myajax.get('http://h6.duchengjiu.top/shop/api_cat.php', {}, function(error, responseText) {
    var data = JSON.parse(responseText);
    for (var k in data) {
      if (k === 'data') {
        for (var i = 0; i < data[k].length; i++) {
          // oUl.innerHTML += '<li>' + data[k][i]['cat_name'] + '</li>';
          oNavUl.innerHTML +=
              `<li><a href="商品列表页.html?cat_id=${data[k][i]['cat_id']}"> ${data[k][i]['cat_name']} </a></li>`;
        }
      }
    }
  });

  myajax.get('http://h6.duchengjiu.top/shop/api_goods.php', {'cat_id': cat_id}, function(error, jsonData) {
    var json = JSON.parse(jsonData)['data'];
    console.log(json);
    for (var i = 0; i < json.length; i++) {
      if(i % 12 === 0) {
        oUl = document.createElement('ul');
        oUl.classList.add('hotProList');
        oUl.classList.add('clearfix');
        hotPro.appendChild(oUl);
      }
      bindDom(json[i]);
    }
  });


  function bindDom(obj) {
    oUl.innerHTML +=
        '<li>\n' +
        '      <a href="商品详情页.html?goods_id='+obj['goods_id']+'">\n' +
        '        <div class="hotProListImg">\n' +
        '          <img src=' + obj['goods_thumb'] + '>\n' +
        '        </div>\n' +
        '        <div class="hotProListInfor">\n' +
        '          <h3 class="hotProName" title=' + obj['goods_name'] + '>' + obj['goods_name'] + '</h3>\n' +
        '          <p class="des">' + obj['goods_desc'] + '</p>\n' +
        '          <span class="price"><i>&yen;</i>' + obj['price'] + '</span>\n' +
        '        </div>\n' +
        '      </a>\n' +
        '    </li>';
  }

  //利用正则匹配查询字符串,并返回向相应的值
  function matchQueryString(str) {
    var queryString = location.search.substr(1);
    var reg = new RegExp('(^|&)' + str + '=([^&]*)(&|$)');
    var backStr = queryString.match(reg);
    if (backStr === null) return null;
    return decodeURIComponent(backStr[2]);             // decodeURIComponent()是为了转化中文字符
  }
</script>
</body>
</html>