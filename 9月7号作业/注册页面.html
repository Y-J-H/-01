<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/register.css">
</head>
<body class="registerBody">
<div class="registerCon">
  <div class="regWrap">
    <h3>注册账号</h3>
    <form class="registerFrom" action="">
      <div>
        <input type="text" name="username" placeholder="用户名">
        <p class="userNameErrorMessage">asdad</p>
      </div>
      <div>
        <input type="password" name="password" placeholder="密码">
        <p class="passwordErrorMessage">asdad</p>
      </div>
      <div>
        <input class="regSub" type="submit" value="提交">
      </div>
    </form>
  </div>
</div>
  <script type="text/javascript" src="js/myajax.js"></script>
  <script type="text/javascript" src="js/表单验证小组件.js"></script>
  <script>
      var oUsername = document.querySelector('input[name = username]');
      var oPassword = document.querySelector('input[name = password]');
      var userError = document.querySelector('.userNameErrorMessage');
      var passError = document.querySelector('.passwordErrorMessage');
      var sub = document.querySelector('input[type = submit ]');

      oUsername.onblur = function() {
        userError.style.display = 'block';
        if(!isAccordReg(oUsername,/^\w{3,20}$/)){
          userError.innerText = '用户名不合法，请填写3-20位的英文数字下划线';
          userError.classList.remove('right');
          userError.classList.add('error');
        }else {
          userError.innerText = '符合要求';
          userError.classList.remove('error');
          userError.classList.add('right');
        }
      };

      oPassword.onblur = function() {
        passError.style.display = 'block';
        if(!isAccordReg(oPassword,/^.{6,}$/)){
          passError.innerText = '密码最小长度为6位';
          passError.classList.remove('right');
          passError.classList.add('error');
        }else {
          passError.innerText = '符合要求';
          passError.classList.remove('error');
          passError.classList.add('right');
        }
      };

      sub.onclick = function(event) {
        var event = event || window.event;
        event.preventDefault();
        myajax.post('http://h6.duchengjiu.top/shop/api_user.php',
            { 'status' : 'register',
              'username' : oUsername.value,
              'password' : oPassword.value
            },
        function(error,jsonData) {
          var data = JSON.parse(jsonData);
          if(data.code === 2001){
            userError.innerText = data.message;
            userError.classList.remove('right');
            userError.classList.add('error');
          }
          if(data.code === 0){
            location.href = "登录.html";
          }
        });
      }
  </script>
</body>
</html>